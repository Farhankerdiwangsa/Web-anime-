<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TongDev | Search - Cari Anime Favoritmu!</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bangers:wght@400&family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <style type="text/tailwindcss">
    @layer base {
      body {
        background-color: #FFF9E0;
        font-family: 'Inter', sans-serif;
        color: #000000;
        overflow-x: hidden;
        padding-bottom: 80px;
      }
    }
    @layer components {
      .comic-title-stroke {
        font-family: 'Bangers', cursive;
        letter-spacing: 1px;
        color: #FFD75C !important;
        text-shadow:
          2px 2px 0 #000,
          -2px -2px 0 #000,
          2px -2px 0 #000,
          -2px 2px 0 #000,
          2px 0 0 #000,
          -2px 0 0 #000,
          0 2px 0 #000,
          0 -2px 0 #000,
          1px 1px 2px rgba(0, 0, 0, 0.6);
      }
      .comic-border {
        border: 4px solid #000000;
      }
      .comic-shadow {
        box-shadow: 6px 6px 0px #000000;
      }
      .bottom-nav-item {
        @apply flex flex-col items-center justify-center p-2 text-textblack tap-highlight-transparent transition-transform duration-200 ease-out;
      }
      .bottom-nav-item .nav-icon {
        @apply text-2xl;
      }
      .bottom-nav-item .nav-text {
        @apply font-bangers text-lg tracking-wide;
      }
      .bottom-nav-item.active {
        @apply text-mustard;
        -webkit-text-stroke: 1px #000;
        text-shadow: 1px 1px 0 #000;
      }
      .inline-tv-loader {
        @apply bg-black comic-border comic-shadow rounded-2xl p-2 w-64 sm:w-80 relative overflow-hidden;
        border-width: 6px;
      }
      .inline-tv-screen {
        @apply w-full aspect-video bg-gray-900 rounded-md relative overflow-hidden flex items-center justify-center;
        box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
      }
      .inline-tv-icon {
        @apply text-mustard text-6xl sm:text-7xl z-10;
        animation: tvSpin 1.8s ease-in-out infinite;
      }
      .inline-tv-screen::before {
        content: '';
        @apply absolute inset-0 w-full h-full z-20;
        background: linear-gradient(to bottom, transparent 0%, rgba(255,255,255,0.03) 50%, transparent 100%);
        background-size: 100% 6px;
        animation: tvScanlines 0.2s linear infinite;
      }
      .inline-tv-screen::after {
        content: '';
        @apply absolute inset-0 w-full h-full z-30 opacity-20;
        background: 
          repeating-linear-gradient(rgba(255,255,255,0.05) 0 1px, transparent 1px 2px),
          repeating-linear-gradient(90deg, rgba(255,255,255,0.05) 0 1px, transparent 1px 2px);
        animation: tvFlicker 1.5s linear infinite;
      }
      @keyframes tvSpin {
        0% { transform: scale(0.8) rotate(0deg); opacity: 0.5; }
        50% { transform: scale(1.1) rotate(15deg); opacity: 1; }
        100% { transform: scale(0.8) rotate(0deg); opacity: 0.5; }
      }
      @keyframes tvScanlines {
        0% { background-position: 0 0; }
        100% { background-position: 0 6px; }
      }
      @keyframes tvFlicker {
        0%, 100% { opacity: 0.2; filter: brightness(0.8); }
        20% { opacity: 0.4; filter: brightness(1); }
        40% { opacity: 0.2; filter: brightness(0.7); }
        60% { opacity: 0.5; filter: brightness(1.2); }
        80% { opacity: 0.3; filter: brightness(0.9); }
      }
    }
    @layer utilities {
      .tap-highlight-transparent {
        -webkit-tap-highlight-color: transparent;
      }
    }
  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            mustard: '#FFC300',
            panel: '#FFF9E0',
            textblack: '#000000',
          },
          fontFamily: {
            bangers: ['Bangers', 'cursive'],
            inter: ['Inter', 'sans-serif'],
          }
        }
      }
    }
  </script>
</head>
<body class="bg-panel text-textblack font-inter">

  <div id="error-state" class="fixed inset-0 bg-mustard z-50 flex justify-center items-center p-4 hidden">
    <div class="bg-panel comic-border rounded-md p-8 sm:p-12 text-center text-textblack comic-shadow max-w-lg w-full">
      <div class="text-7xl sm:text-9xl">ðŸš«</div>
      <div class="comic-title-stroke text-5xl sm:text-7xl text-mustard mt-4">
        Oops! Gagal Muat!
      </div>
      <div class="font-inter text-xl sm:text-2xl mt-6">
        Tidak bisa memuat data. Coba lagi nanti, ya!
      </div>
      <button id="retry-button" class="mt-10 bg-mustard font-bangers text-3xl px-10 py-3 comic-border rounded-md comic-shadow text-textblack comic-title-stroke tracking-wider transition-transform duration-200 hover:scale-105 active:scale-95">
        Coba Lagi
      </button>
    </div>
  </div>

  <div id="main-content">
    <header id="navbar" class="bg-panel px-4 pt-6 pb-4 md:px-8 sticky top-0 z-30">
      <div class="relative flex items-center w-full bg-mustard comic-border rounded-2xl comic-shadow overflow-hidden">
        <i class="fa-solid fa-magnifying-glass text-textblack text-xl sm:text-2xl absolute left-4 sm:left-6"></i>
        <input type="text" id="search-input" 
               class="w-full bg-transparent text-textblack font-inter text-lg sm:text-xl placeholder:text-textblack/60 placeholder:italic 
                      py-4 sm:py-5 pl-12 sm:pl-16 pr-6 
                      border-none outline-none ring-0 
                      focus:ring-4 focus:ring-textblack transition-all duration-200 ease-in-out"
               placeholder="Cari anime favoritmu di sini...">
      </div>
    </header>

    <section id="search-banner-section" class="bg-panel shadow-lg overflow-hidden relative w-full pt-0 px-4 md:px-8">
    </section>

    <section id="content-section" class="px-4 py-6">
      <div id="anime-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 min-h-60">
      </div>
    </section>

    <nav id="bottom-navigation" class="fixed bottom-0 left-0 right-0 bg-mustard border-t-8 comic-border p-1 z-30 flex justify-around items-center comic-shadow" style="box-shadow: 0px -6px 0px #000000;">
      <a href="index.html" class="bottom-nav-item">
        <i class="fa-solid fa-house nav-icon"></i>
        <span class="nav-text">Home</span>
      </a>
      <a href="latest.html" class="bottom-nav-item">
        <i class="fa-solid fa-clock nav-icon"></i>
        <span class="nav-text">Terbaru</span>
      </a>
      <a href="search.html" class="bottom-nav-item active" aria-current="page">
        <i class="fa-solid fa-search nav-icon"></i>
        <span class="nav-text">Search</span>
      </a>
      <a href="populer.html" class="bottom-nav-item">
        <i class="fa-solid fa-star nav-icon"></i>
        <span class="nav-text">Populer</span>
      </a>
      <a href="auth.html" class="bottom-nav-item">
        <i class="fa-solid fa-user nav-icon"></i>
        <span class="nav-text">Profil</span>
      </a>
    </nav>
  </div>
  <script>
    const LATEST_API = "https://backend.syaii.my.id/api/latest?page=1";
    const SEARCH_API = "https://backend.syaii.my.id/api/search?q=";

    const animeListContainer = document.getElementById('anime-list');
    const searchInput = document.getElementById('search-input');
    const searchBannerContainer = document.getElementById('search-banner-section');
    const errorState = document.getElementById('error-state');
    const mainContent = document.getElementById('main-content');
    const retryButton = document.getElementById('retry-button');

    function createAnimeCard(anime) {
      const placeholderImg = 'https://placehold.co/200x300/F0F0F0/000?text=Img+Error';
      return `
        <a href="detail.html?url=${encodeURIComponent(anime.detailLink)}" 
           class="block bg-white rounded-md shadow-lg overflow-hidden cursor-pointer transition-all duration-300 ease-in-out hover:scale-105 tap-highlight-transparent opacity-0 translate-y-4">
            <div class="w-full aspect-[2/3] overflow-hidden">
                <img src="${anime.imageUrl}" 
                     alt="${anime.title}" 
                     class="w-full h-full object-cover" 
                     onerror="this.src='${placeholderImg}'">
            </div>
            <div class="p-3 text-center">
                <p class="text-sm font-inter font-semibold text-gray-900 truncate">${anime.title}</p>
            </div>
        </a>
      `;
    }

    function createBannerSlide(title, thumbUrl, badgeText, infoText, backgroundUrl, detailLink) {
      const placeholder = 'https://placehold.co/400x600/FFF9E0/000?text=TongDev';
      const bgUrl = backgroundUrl || thumbUrl;
      return `
        <div class="relative block w-full aspect-[2/1] md:aspect-[21/9] overflow-hidden comic-border rounded-md comic-shadow bg-mustard group tap-highlight-transparent">
          <img src="${bgUrl || placeholder}"
               alt="Background for ${title}"
               class="absolute inset-0 w-full h-full object-cover filter blur-lg scale-105"
               onerror="this.src='${placeholder}'">
          <div class="absolute inset-0 w-full h-full bg-black/40 backdrop-blur-sm"></div>
          <div class="relative z-10 w-full h-full p-4 sm:p-8 md:p-12 flex flex-col md:flex-row items-center justify-start text-white">
            <img src="${thumbUrl || placeholder}"
                 alt="${title}"
                 class="block h-40 sm:h-56 md:h-full aspect-[2/3] object-cover border-4 border-black rounded-md shadow-lg flex-shrink-0"
                 onerror="this.src='${placeholder}'">
            <div class="md:ml-8 lg:ml-12 mt-4 md:mt-0 text-left w-full md:w-auto">
              <span class="font-bangers text-lg sm:text-xl text-textblack bg-mustard border-2 border-black rounded-full px-4 py-1 inline-block comic-shadow">
                ${badgeText}
              </span>
              <h3 class="comic-title-stroke text-3xl sm:text-4xl lg:text-6xl text-mustard mt-2" title="${title}">
                ${title}
              </h3>
              <p class="font-inter font-bold text-base sm:text-xl lg:text-2xl text-white bg-black/50 border-2 border-white/50 rounded-lg px-4 py-2 inline-block mt-4 max-w-lg">
                ${infoText}
              </p>
              ${detailLink ? `
                <a href="detail.html?url=${encodeURIComponent(detailLink)}"
                   class="bg-mustard text-black font-bangers text-2xl px-6 py-3 rounded-lg comic-border comic-shadow transition-transform duration-300 hover:scale-105 active:scale-95 inline-block mt-4">
                   Lihat Detail
                </a>
              ` : ''}
            </div>
          </div>
        </div>
      `;
    }

    function renderSearchBanner(item) {
      const infoText = `Tipe: ${item.type} | Status: ${item.status}`;
      const slideHTML = createBannerSlide(
        item.title,
        item.imageUrl,
        `Rating: ${item.rating || 'N/A'}`,
        infoText,
        item.imageUrl,
        item.detailLink
      );
      searchBannerContainer.innerHTML = `
        <h2 class="font-bangers text-3xl text-textblack tracking-wider comic-title-stroke text-mustard mb-4 mt-6">
          Hasil Pencarian Anda
        </h2>
        ${slideHTML}
      `;
    }

    function renderCards(animeList) {
      if (animeList.length === 0) {
        animeListContainer.innerHTML = `
          <div class="col-span-2 sm:col-span-3 md:col-span-4 lg:col-span-5 flex items-center justify-center min-h-60">
            <p class="text-xl font-inter text-textblack/70">Tidak ada hasil ditemukan.</p>
          </div>
        `;
        return;
      }
      const cardHTML = animeList.map(createAnimeCard).join('');
      animeListContainer.innerHTML = cardHTML;
      
      const cards = animeListContainer.querySelectorAll('a');
      cards.forEach((card, index) => {
        setTimeout(() => {
          card.classList.remove('opacity-0', 'translate-y-4');
        }, index * 50);
      });
    }

    function showContentLoader() {
      animeListContainer.innerHTML = `
        <div id="tv-loader-wrapper" class="col-span-2 sm:col-span-3 md:col-span-4 lg:col-span-5 flex items-center justify-center min-h-60 opacity-0 transition-opacity duration-500 ease-in-out">
          <div class="inline-tv-loader">
            <div class="inline-tv-screen">
              <i class="fa-solid fa-magnifying-glass inline-tv-icon"></i>
            </div>
          </div>
        </div>
      `;
      setTimeout(() => {
        const loaderWrapper = document.getElementById('tv-loader-wrapper');
        if (loaderWrapper) {
          loaderWrapper.classList.remove('opacity-0');
        }
      }, 10);
    }

    function showErrorState() {
      errorState.classList.remove('hidden');
      mainContent.classList.add('hidden');
    }

    function hideErrorState() {
      errorState.classList.add('hidden');
      mainContent.classList.remove('hidden');
    }

    async function handleFetch(url, isSearch = false) {
      searchBannerContainer.innerHTML = '';
      showContentLoader();

      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error('Gagal memuat data');
        const data = await response.json();
        
        const loaderWrapper = document.getElementById('tv-loader-wrapper');
        if (loaderWrapper) {
          loaderWrapper.classList.add('opacity-0');
          await new Promise(resolve => setTimeout(resolve, 500));
        }

        if (isSearch) {
          if (data.length > 0) {
            renderSearchBanner(data[0]); 
            renderCards(data); 
          } else {
            renderCards([]);
          }
        } else {
          renderCards(data);
        }
        hideErrorState();
      } catch (error) {
        const loaderWrapper = document.getElementById('tv-loader-wrapper');
        if (loaderWrapper) {
          loaderWrapper.classList.add('opacity-0');
          await new Promise(resolve => setTimeout(resolve, 500));
        }
        showErrorState();
      }
    }

    function handleSearch(event) {
      if (event.keyCode === 13) {
        event.preventDefault();
        const query = searchInput.value.trim();
        
        if (query) {
          handleFetch(SEARCH_API + encodeURIComponent(query), true);
        } else {
          handleFetch(LATEST_API, false);
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (retryButton) {
        retryButton.addEventListener('click', () => {
          hideErrorState();
          searchInput.value = '';
          handleFetch(LATEST_API, false);
        });
      }
      
      searchInput.addEventListener('keydown', handleSearch);
      
      handleFetch(LATEST_API, false);
    });
  </script>
</body>
</html>